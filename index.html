<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <title>Mint</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Language" content="zh-CN" />
    <link rel="stylesheet" type="text/css" href="css/css.css">
    <script type="text/javascript" src='js/jquery-2.1.3.min.js'></script>
</head>
<body>
    <div id="mian">
        <div class="col-11">
            <div class="col-12" id="images">
            </div>

            <div class="col-12" id="imageURI">
            </div>
        </div>

        <div class="col-1">
            <button type="button" class="btn btn-success" id="query">发送</button>
        </div>
    </div>
<script type="text/javascript">
    (function(){
        var reader;
        var imgReader = function( item ){
            var blob = item.getAsFile();
            reader = new FileReader();

            reader.onload = function( e ){
                var img = new Image();
                img.id = 'Image';
                img.src = e.target.result;

                $("#images").html('');
                $("#images").append(img);

            };
            reader.readAsDataURL(blob);
        };

        // demo 程序将粘贴事件绑定到 document 上
        document.addEventListener("paste", function (e) {
            var cbd = e.clipboardData;
            var ua = window.navigator.userAgent;

            // 如果是 Safari 直接 return
            if ( !(e.clipboardData && e.clipboardData.items) ) {
                return;
            }

            // Mac平台下Chrome49版本以下 复制Finder中的文件的Bug Hack掉
            if(cbd.items && cbd.items.length === 2 && cbd.items[0].kind === "string" && cbd.items[1].kind === "file" &&
                cbd.types && cbd.types.length === 2 && cbd.types[0] === "text/plain" && cbd.types[1] === "Files" &&
                ua.match(/Macintosh/i) && Number(ua.match(/Chrome\/(\d{2})/i)[1]) < 49){
                return;
            }

            for(var i = 0; i < cbd.items.length; i++) {
                var item = cbd.items[i];
                if(item.kind == "file"){
                    var blob = item.getAsFile();
                    if (blob.size === 0) {
                        alert('请选择图片');
                        return;
                    }
                    imgReader( item );
                    return;
                    // blob 就是从剪切板获得的文件 可以进行上传或其他操作
                }
            }
            alert('请选择图片');
        }, false);

        $("#query").click(function (e) {
            var image = document.getElementById('Image');
            if(!image){
                alert('请选择图片');
                return;
            }
            var hash = md5(reader.result);
            console.log(hash);
            // TODO: 上传文件
            // $.ajax({
            //     url: ''
            // })
        });

    })();

</script>
</body>
</html>
